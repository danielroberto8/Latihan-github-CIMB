<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      let arrItems = [
        {
          nama: "ANGGUR",
          stock: 50,
          price: 2500,
          qty: 0
        },
        {
          nama: "DURIANN",
          stock: 50,
          price: 1500,
          qty: 0
        },
        {
          nama: "MELOOON",
          stock: 50,
          price: 8000,
          qty: 0
        },
        {
          nama: "NANASSS",
          stock: 50,
          price: 3500,
          qty: 0
        }
      ];
      //Boolean data type
      let isRepeat = true;
      let isEmpty = true;
      let isConfirmed = false;
      let isExit = false;
      //String data type
      let choices = "";
      let daftarBuah = "";
      let daftarBelanja = "";
      let tempInput = "";
      let menuAdmin = "";
      //Integer data type
      let change = 0;
      let jumlahBelanja = 0;
      let key = 0;
      let pay = 0;
      let totalBelanja = 0;
      let i = 0;

      //MAIN PROGRAM
      do {
        mainMenu();
        if (choices == 1) {
          adminMenu();
          isRepeat = true;
        } else if (choices == 2) {
          userMenu();
          isRepeat = true;
        } else if (choices == 3) {
          isRepeat = confirm("Apakah anda yakin ingin keluar?\n");
          if (isRepeat == false) {
            isRepeat = true;
          } else {
            isRepeat = false;
          }
        } else {
          alert("Inputnya tidak valid sapri.");
          isRepeat = true;
        }
      } while (isRepeat);

      //FUNCTION LIST
      function mainMenu() {
        choices = prompt("1.Admin\n2.User\n3.Exit\n");
      }

      function adminMenu() {
        do {
          choices = prompt("ADMIN MENU\n1.Add item\n2.Exit to main menu\n");
          if (choices == 1) {
            addItemList();
          } else {
            isRepeat = false;
          }
        } while (isRepeat);
      }

      function userMenu() {
        do {
          resetCondition();
          do {
            displayMenu();
            if (choices == "C") {
              displayCart();
              isExit = false;
            } else if (choices < arrItems.length + 1) {
              addItemCart(key);
              //protection apabila input tidak valid dan user memilih cancel
              isRepeat = true;
            } else if (choices == arrItems.length + 1) {
              isRepeat = false;
              isExit = true;
            } else {
              alert("input yang anda masukkan tidak valid.");
              isRepeat = true;
            }
          } while (isRepeat);

          if (isExit) {
            continue;
          }

          do {
            transaksi();
          } while (isRepeat);

          stockControl();

          isRepeat = confirm("Duit masih banyak kan?\nBelanja lagi lahh");
        } while (isRepeat);
      }

      function addItemList() {
        let namaBuahTemp = "";
        let stockBuahTemp = 0;
        let hargaBuahTemp = 0;
        let isValid = true;
        do {
          do {
            namaBuahTemp = prompt("Masukkan nama buah :").toUpperCase();
            for (i = 0; i < arrItems.length; i++) {
              if (arrItems[i].nama == namaBuahTemp) {
                alert("Nama buah sudah ada.");
                isRepeat = true;
                break;
              } else {
                isRepeat = false;
              }
            }
          } while (isRepeat);

          do {
            stockBuahTemp = parseInt(prompt("Masukkan stock buah :"));
            if (stockBuahTemp > 0) {
              isRepeat = false;
            } else {
              alert("Jangan masukin angka minus bang.");
              isRepeat = true;
            }
          } while (isRepeat);

          do {
            hargaBuahTemp = parseInt(prompt("Masukkan harga buah :"));
            if (hargaBuahTemp > 0) {
              isValid = true;
              isRepeat = false;
            } else {
              alert("Jangan masukin angka minus bang.");
              isRepeat = true;
            }
          } while (isRepeat);

          if (isValid) {
            arrItems.push({
              nama: namaBuahTemp,
              stock: stockBuahTemp,
              price: hargaBuahTemp,
              qty: 0
            });
            isRepeat = false;
          } else {
            isRepeat = true;
          }
        } while (isRepeat);
      }

      function displayMenu() {
        //Menampilkan daftar buah, harga, stok dan menampilkan prompt input
        daftarBuah = "Daftar Buah Segar\n";
        for (i = 0; i < arrItems.length; i++) {
          daftarBuah += `\n${i + 1}.${arrItems[i].nama}\tIDR Rp.${
            arrItems[i].price
          }\tstock :${arrItems[i].stock}`;
        }
        daftarBuah +=
          "\n" +
          (arrItems.length + 1) +
          '.Exit to main menu\n\nketik nomor buah untuk membeli.\nKetik "C" untuk melihat keranjang belanjaan dan lanjut ke pembayaran.';
        choices = prompt(daftarBuah).toUpperCase();
      }

      function displayCart() {
        daftarBelanja = "Daftar belanja anda\n\nNo.\tNama Buah\tJumlah";
        for (i = 0; i < arrItems.length; i++) {
          //Memeriksa item apa yang sudah dipilih
          if (arrItems[i].qty > 0) {
            daftarBelanja += `\n${i + 1}.\t${arrItems[i].nama}\t${
              arrItems[i].qty
            }`;
            isEmpty = false; //Jika ada input maka daftar belanja tidak kosong
          }
        }
        if (isEmpty) {
          //Jika tidak ada item yang sudah dipilih maka eksekusi line berikut
          daftarBelanja += "\n\nBelum ada daftar belanja.\nBelanja dulu gih.";
          alert(daftarBelanja);
        } else {
          //Jika daftar belanja tidak kosong, maka eksekusi line berikut
          daftarBelanja += '\n\nKlik "OK" untuk lanjut ke pembayaran';
          alert(daftarBelanja);
          //konfirmasi jika user ingin bayar atau belanja lagi
          if (isRepeat) {
            isConfirmed = confirm(
              `Jumlah barang yang akan anda beli ${jumlahBelanja}\nDengan total harga yang harus dibayar adalah Rp.${totalBelanja}\n\nApakah anda yakin ingin melanjutkan ke pembayaran?\n(Klik "CANCEL" jika masih ingin belanja)`
            );
            if (isConfirmed) {
              isRepeat = false;
            } else {
              isRepeat = true;
            }
          }
        }
      }

      function addItemCart(key) {
        do {
          //Menampilkan prompt input untuk buah yang dipilih
          key = choices - 1;
          tempInput = parseInt(
            prompt(`Berapa jumlah ${arrItems[key].nama} yang ingin anda beli?`)
          );
          //Memeriksa apakah input dari user valid atau tidak
          //(input tidak melebihi stok dan input tidak bernilai negatif)
          if (
            arrItems[key].qty + tempInput <= arrItems[key].stock &&
            tempInput >= 0
          ) {
            //Merubah nilai dari qty buah yang dipilih
            arrItems[key].qty += tempInput;
            //Menghitung jumlah item yang sudah dipilih user
            jumlahBelanja += tempInput;
            //Menghitung total belanja dari user
            totalBelanja += tempInput * arrItems[key].price;
            break;
          } else {
            isRepeat = confirm(
              "Jumlah yang anda masukkan tidak valid kisanak.\nIngin mengulangi proses input?"
            );
          }
        } while (isRepeat);
      }

      function transaksi() {
        pay = prompt(
          `Total belanja Anda Rp.${totalBelanja}\nSilahkan masukkan nominal uang anda`
        );
        //Kondisi jika uang yang dibayar lebih besar dari total belanja
        if (pay > totalBelanja) {
          change = pay - totalBelanja;
          alert(`Kembalian anda Rp.${change}\nMakasih yak`);
          isRepeat = false;
        }
        //Kondisi jika uang yang dibayar pas mantab
        else if (pay == totalBelanja) {
          alert("Uangnya pas.\nMantap.");
          isRepeat = false;
        } else if (pay < 0) {
          //Kondisi jika usernya iseng memasukkan bilangan negatif
          alert(
            "Jangan masukin nilai negatif bambang.\nSilahkan masukkan input yang benar."
          );
          isRepeat = true;
          //Kondisi jika uang user lebih kecil dari total belanjaan
        } else {
          totalBelanja -= pay;
          alert(
            `Uangnya kurang Rp.${totalBelanja}\nMasukkan jumlah uang yang gedean.`
          );
          isRepeat = true;
        }
      }

      function resetCondition() {
        jumlahBelanja = 0;
        totalBelanja = 0;
        key = 0;
        pay = 0;
        isEmpty = true;
        isConfirmed = false;
        //clean item qty untuk iterasi berikutnya
        for (i = 0; i < arrItems.length; i++) {
          arrItems[i].qty = 0;
        }
      }

      function stockControl() {
        //Mengurangi stok buah
        for (i = 0; i < arrItems.length; i++) {
          arrItems[i].stock -= arrItems[i].qty;
        }

        //Memeriksa stok buah
        for (i = 0; i < arrItems.length; i++) {
          if (arrItems[i].stock > 0) {
            isEmpty = false;
          }
        }
        if (isEmpty) {
          alert("Stock buahnya habis semua bunda :(");
          isRepeat = false;
        }
      }
    </script>
  </body>
</html>